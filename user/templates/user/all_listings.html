<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Listings</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>All Listings</h1>

    <!-- Форма для поиска и фильтрации -->
    <form method="GET" id="filterForm">
        <!-- Поиск по заголовку и описанию -->
        <input type="text" name="q" placeholder="Search by title or description" value="{{ request.GET.q }}">

        <!-- Фильтрация по цене -->
        <input type="number" name="min_price" placeholder="Min Price" value="{{ request.GET.min_price }}">
        <input type="number" name="max_price" placeholder="Max Price" value="{{ request.GET.max_price }}">

        <!-- Фильтрация по местоположению -->
        <input type="text" name="location" placeholder="Location" value="{{ request.GET.location }}">

        <!-- Фильтрация по количеству комнат -->
        <input type="number" name="room_count" placeholder="Min Rooms" value="{{ request.GET.room_count }}">

        <!-- Фильтрация по типу жилья -->
        <select name="property_type">
            <option value="">All Types</option>
            <option value="Apartment" {% if request.GET.property_type == 'Apartment' %}selected{% endif %}>Apartment</option>
            <option value="House" {% if request.GET.property_type == 'House' %}selected{% endif %}>House</option>
            <option value="Studio" {% if request.GET.property_type == 'Studio' %}selected{% endif %}>Studio</option>
        </select>

        <!-- Сортировка по цене или дате добавления -->
        <select name="sort_by">
            <option value="price" {% if request.GET.sort_by == 'price' %}selected{% endif %}>Sort by Price</option>
            <option value="created_at" {% if request.GET.sort_by == 'created_at' %}selected{% endif %}>Sort by Date</option>
        </select>

        <!-- Порядок сортировки (возрастание или убывание) -->
        <select name="order">
            <option value="asc" {% if request.GET.order == 'asc' %}selected{% endif %}>Ascending</option>
            <option value="desc" {% if request.GET.order == 'desc' %}selected{% endif %}>Descending</option>
        </select>

        <button type="submit">Filter</button>
    </form>

    <!-- Список объявлений -->
    <ul id="itemList">
        {% for listing in listings %}
        <li>
            <h2>{{ listing.title }}</h2>
            <p>{{ listing.description }}</p>
            <p>Location: {{ listing.location }}</p>
            <p>Price: {{ listing.price }}</p>
            <p>Rooms: {{ listing.room_count }}</p>
            <p>Type: {{ listing.housing_type }}</p>
            <p>Created at: {{ listing.created_at }}</p>
            <p>Updated at: {{ listing.updated_at }}</p>
        </li>
        {% empty %}
        <li>No listings found</li>
        {% endfor %}
    </ul>

    <!-- Сортировка и фильтрация через форму -->
    <script>
        $('#sortForm').on('submit', function(e) {
            e.preventDefault();
            let formData = $(this).serialize();
            $.ajax({
                url: "{% url 'user:item-list' %}",
                method: 'GET',
                data: formData,
                success: function(response) {
                    $('#itemList').html(response);
                }
            });
        });
    </script>
</body>
</html>